---
sidebar: sidebar 
permalink: task_config_telegraf_agent_k8s.html 
keywords: telegraf, installation, install, agent, telegraf agent, kubernetes, eks, operator, k8s 
summary: Cloud Insights は、 Kubernetes で統合データを収集するエージェントとして Telegraf をサポートしています。 
---
= NetApp Kubernetes Monitoring Operatorの設定
:allow-uri-read: 


[role="lead"]
Cloud Insights では、などの多くのコンポーネントが使用されます link:https://docs.fluentbit.io/manual["流暢なビット"] および link:https://docs.influxdata.com/telegraf/["Tegraf"]をクリックしてください。Telegraf はプラグインベースのサーバエージェントで、指標、イベント、ログの収集とレポートに使用できます。入力プラグインは、システム /OS に直接アクセスするか、サードパーティ API を呼び出すか、設定されたストリームをリスニングすることによって、エージェントに必要な情報を収集するために使用されます（例：） Kafka や StatsD など）を参照してください。出力プラグインは、収集した指標、イベント、およびログをエージェントから Cloud Insights に送信するために使用します。


toc::[]
Cloud Insights では、Kubernetesコレクション向けにNetApp Kubernetes Monitoring Operator *（NKMO）を提供しています。データコレクタを追加するときは、「Kubernetes」タイルを選択するだけです。

image:kubernetes_tile.png["Kubernetes Data Collectorのタイル"]

以下は、オペレータが環境内のどこに配置されているかを示す大まかな図です。環境によっては、_Proxy Server_が必要になる場合と不要になる場合があります。

image:CI_Diagram_with_NKMO.png["Kubernetesクラスタ内に存在するNKMOを示すハイレベルなマップ。矢印は、ホスト、プロキシサーバからクラスタにデータが移動し、すべてがCloud Insights にロールアップされる様子を示しています"]

演算子(NKMO)とデータコレクタは、Cloud Insights Dockerレジストリからダウンロードされます。インストールが完了すると、NKMOはKubernetesクラスタノードに導入されたOperator互換コレクタを管理してデータを取得します。これには、コレクタのライフサイクルの管理も含まれます。このチェーンに続いて、データがコレクタから取得され、Cloud Insights に送信されます。



== NetApp Kubernetes Monitoring Operatorをインストールする前に

[[nkmoversion]]
.前提条件
* 4e6966e86a775d896fac148f8f919b74
+
** 9de2afa9a42c7e74a8b83bbef4f14c20
** 6c7ca580ed97b823c501ac9c614a22e3
** 479cd5be40ccd07011d75823574c7b07
** a36b7ead4d7f7dfbc23cbc2511314f24
** 09fac59df2e8bc91f55d933bf9d5c4b9


* NetApp Kubernetes Monitoring Operatorインストールは、Kubernetesバージョン1.20以降でサポートされます。
* Cloud Insights がバックエンドストレージを監視しており、KubernetesがDockerコンテナランタイムとともに使用されている場合、Cloud Insights はNFSおよびiSCSIのポッドとPVとストレージのマッピングと指標を表示できます。それ以外のランタイムではNFSのみが表示されます。
* 1d71a30c3f76311c39e7b21e9d36041f
* ceb4fea071151ab6bb0ff80a20993744
* 56cb6633aba007c9c91082eb591c6ac6
+
748fdb05a8ec278d9ce5ea3bde4405f4

+
|===


| プラットフォーム | ラベル 


| Kubernetes v1.20以降 | Kubernetes の IO / OS = Linux 


| Rancher + catt.io をオーケストレーション / Kubernetes プラットフォームとして使用 | catt.io/os=linux 
|===
* NetApp Kubernetes Monitoring Operatorとその依存関係（テレグラム、kube-state-metrics、Fluentbitなど）は、Arm64アーキテクチャで実行されているノードではサポートされません。
* fcb70ec2b5ff14dcc062955ceca887b6
* 82f6a763fe60e4e576dfec4afd406d65
* 951a50d1b55837ddb5ff4cb5af4ebc8a
* abd3f7869ce900c36e8cd1dc95b25a52
* 4e7860768ab50263cd322fefea021fdc


正確な監査およびデータレポートを作成するためには、 * Network Time Protocol （ NTP; ネットワークタイムプロトコル） * または * Simple Network Time Protocol （ SNTP ） * を使用して、 Agent マシンの時刻を同期することを強くお勧めします。



== 開始する前に、これらの点に注意してください

を使用してを実行する場合 <<configuring-proxy-support,プロキシ>>を使用してください <<using-a-custom-or-private-docker-repository,カスタムリポジトリ>>またはを使用している <<openshift-instructions,OpenShift>>を参照してください。

以前のインストールからアップグレードする場合は、も参照してください <<をアップグレードして,をアップグレードして>> 情報。

d0924ee26918b7c9acc0ec062a178e01



=== プロキシサポートを設定しています

環境にプロキシを使用してNetApp Kubernetes Monitoring Operatorをインストールする方法は2つあります。同じプロキシシステムでも、別のプロキシシステムでもかまいません。

* プロキシは、インストールコードスニペット（「curl」を使用）の実行中に、スニペットが実行されるシステムをCloud Insights 環境に接続するために必要です
* ターゲットのKubernetesクラスタがCloud Insights 環境と通信するために必要なプロキシ


これらのいずれか、または両方にプロキシを使用する場合は、NetApp Kubernetes Operating Monitorをインストールするために、まずCloud Insights 環境との良好な通信を可能にするようにプロキシが設定されていることを確認する必要があります。プロキシがあり、オペレータをインストールするサーバ/VMからCloud Insights にアクセスできる場合は、プロキシが適切に設定されている可能性があります。

NetApp Kubernetes Operating Monitorのインストールに使用するプロキシとして、オペレータをインストールする前に、_http_proxy/https_proxy_environment変数を設定します。一部のプロキシ環境では'_no_proxy環境変数も設定する必要があります

変数を設定するには、NetApp Kubernetes Monitoring Operatorをインストールする前に、システムで次の手順を実行します。

. 現在のユーザの _https_proxy_ 変数と _http_proxy_environment 変数を設定します。
+
.. セットアップするプロキシに認証（ユーザ名/パスワード）がない場合は、次のコマンドを実行します。
+
 export https_proxy=<proxy_server>:<proxy_port>
.. セットアップするプロキシに認証（ユーザ名/パスワード）が設定されている場合は、次のコマンドを実行します。
+
 export http_proxy= <proxy_username>:<proxy_password>@<proxy_server>:<proxy_port>




KubernetesクラスタがCloud Insights 環境と通信するために使用するプロキシについては、以下の手順をすべて読み、NetApp Kubernetes Monitoring Operatorをインストールします。

e070931bcf07d2c50211632028c7aa04

c0c113f7f05cafdbe990d465db2be0e5

 kubectl -n netapp-monitoring edit agent agent-monitoring-netapp
5736221dbd17920aab4d48e61c7f1c4f

[listing]
----
 proxy:

 # If an AU is enabled on your cluster for monitoring
 # by Cloud Insights, then isAuProxyEnabled should be set to true:
  isAuProxyEnabled: <true or false>

 # If your Operator install is behind a corporate proxy,
 # isTelegrafProxyEnabled should be set to true:
  isTelegrafProxyEnabled: <true or false>

 # If LOGS_COLLECTION is enabled on your cluster for monitoring
 # by CI, then isFluentbitProxyEnabled should be set to true:
  isFluentbitProxyEnabled: <true or false>

 # Set the following values according to your proxy login:
  password: <password for proxy, optional>
  port: <port for proxy>
  server: <server for proxy>
  username: <username for proxy, optional

 # In the noProxy section, enter a comma-separated list of
 # IP addresses and/or resolvable hostnames that should bypass
 # the proxy:
  noProxy: <comma separated list>
----


=== カスタムまたはプライベートのDockerリポジトリを使用する

9d270fc3981764bdd3e499e4f29c806e

278e14bf473bd997ecfb9729513ee3dc

. 76a29f4ebdb348450a0322a9c98cb4bf
+
 kubectl -n netapp-monitoring get secret docker -o yaml
. 3910d1d80274049b67c375b0000311fb
. 683b8010d170fc689e256c2461d9ed7e
+
 echo <paste from _.dockerconfigjson:_ output above> | base64 -d


77cc6d4eb48f196cb4ec9933aeef1586

....
{ "auths":
  {"docker.<cluster>.cloudinsights.netapp.com" :
    {"username":"<tenant id>",
     "password":"<password which is the CI API token>",
     "auth"    :"<encoded username:password basic auth token. This is internal to docker>"}
  }
}
....
e46ad1cf454a36b0aa27d5cb43692c6b

....
docker login docker.<cluster>.cloudinsights.netapp.com (from step #2) -u <username from step #2>
password: <password from docker secret step above>
....
db14bf839f053975690a0aa27f23e573

....
docker pull docker.<cluster>.cloudinsights.netapp.com/netapp-monitoring:<version>
docker pull docker.<cluster>.cloudinsights.netapp.com/distroless-root-user:<version>
....
231509eaa9ac837e90f55a78ed5a859e

 kubectl -n netapp-monitoring describe deployment monitoring-operator | grep -i "image:" |grep netapp-monitoring
6c427ef0d84924952ea57287d5c12a55

....
docker pull docker.<cluster>.cloudinsights.netapp.com/telegraf:<telegraf version>
docker pull docker.<cluster>.cloudinsights.netapp.com/kube-rbac-proxy:<kube-rbac-proxy version>
docker pull docker.<cluster>.cloudinsights.netapp.com/kube-state-metrics:<kube-state-metrics version>
....
cb43d6ddfc5892dafbf435fffd06e735

....
docker pull docker.<cluster>.cloudinsights.netapp.com/fluent-bit:<fluent-bit version>
docker pull docker.<cluster>.cloudinsights.netapp.com/kubernetes-event-exporter:<kubernetes-event-exporter version>
....
5fdef5014971511d708c48ee3a739357

0ee913a9f3f55f5a7505703cd1663976

....
image: <docker repo of the enterprise/corp docker repo>/kube-rbac-proxy:<kube-rbac-proxy version>
image: <docker repo of the enterprise/corp docker repo>/netapp-monitoring:<version>
....
5c19ae7a43d3f48864d792ef857eb222

 kubectl -n netapp-monitoring edit agent agent-monitoring-netapp
....
docker-repo: <docker repo of the enterprise/corp docker repo>
dockerRepoSecret: <optional: name of the docker secret of enterprise/corp docker repo, this secret should be already created on the k8s cluster in the same namespace>
....
2f467f6ec28d4dda9efc2d651f82d1b6

....
spec:
  telegraf:
    - name: ksm
      substitutions:
        - key: k8s.gcr.io
          value: <same as "docker-repo" field above>
....


=== OpenShift の手順

725add584c7b017b758ee4ca5893c90a

 kubectl edit agent agent-monitoring-netapp -n netapp-monitoring
7413b27c2a74484b9a0ae0a20c26cd28

OpenShiftは、一部のKubernetesコンポーネントへのアクセスをブロックする可能性のある追加のセキュリティレベルを実装する場合があります。



== NetApp Kubernetes Monitoring Operatorをインストールします

40dd3c1786c7903240a93eee2a772bf3

.NetApp Kubernetes Monitoring Operator Agent を Kubernetes にインストールする手順：
. 一意のクラスタ名およびネームスペースを入力してください。実行中の場合 <<をアップグレードして,をアップグレードして>> スクリプトベースのエージェントまたは以前のKubernetes Operatorから、同じクラスタ名とネームスペースを使用します。
. 5b82931325db3333d72e29bd0c4c7b88
. 69fe7b86f073ff27417a8bb4f40bf251
. 652fa40fdabd874246411d062f2d1615
. ecf5918b75414ec8e1874242a839d017



NOTE: aadc028d0de86e5da522c42edd9e1336


NOTE: a14c6d1b4b0dd061b28b6390917f22a1



== をアップグレードして


NOTE: 以前にスクリプトベースのエージェントをインストールしている場合は、NetApp Kubernetes Monitoring Operatorにアップグレードする必要があります。



=== スクリプトベースのエージェントからNetApp Kubernetes Monitoring Operatorへのアップグレード

テレグラムエージェントをアップグレードするには、次の手順に従います。

. Cloud Insights が認識するクラスタ名をメモしておきます。クラスタ名を確認するには、次のコマンドを実行します。名前空間がデフォルト（_CI-MOTing_）でない場合は、適切な名前空間を置き換えます。
+
 kubectl -n ci-monitoring get cm telegraf-conf -o jsonpath='{.data}' |grep "kubernetes_cluster ="


. K8sオペレータベースの監視解決策 のインストール中に使用するK8sクラスタ名を保存して、データの継続性を確保します。
+
CIにKubernetesクラスタの名前を覚えていない場合は、次のコマンドラインを使用して、保存した構成からクラスタを抽出できます。

+
 cat /tmp/telegraf-configs.yaml | grep kubernetes_cluster | head -2
. スクリプトベースの監視を削除します
+
Kubernetes 上のスクリプトベースのエージェントをアンインストールするには、次の手順を実行します。

+
モニタリングネームスペースが Telegraf 専用に使用されている場合：

+
 kubectl --namespace ci-monitoring delete ds,rs,cm,sa,clusterrole,clusterrolebinding -l app=ci-telegraf
+
 kubectl delete ns ci-monitoring
+
モニタリングネームスペースが Telegraf 以外の目的で使用されている場合：

+
 kubectl --namespace ci-monitoring delete ds,rs,cm,sa,clusterrole,clusterrolebinding -l app=ci-telegraf
. <<installing-the-netapp-kubernetes-monitoring-operator,をインストールします>> 現在の演算子。必ず、上記の手順1と同じクラスタ名を使用してください。




=== 最新のNetApp Kubernetes Monitoring Operatorにアップグレードします

0fcb89be13d6b554b3b15359f81a94da

* 34d201ca97c6d320bf1d9a8290e56e6d
+
 kubectl -n netapp-monitoring get agent -o jsonpath='{.items[0].spec.cluster-name}'


1add7b4bfd24c3b007b38922bea24831

61555de764999433d6f85da2969523dd



== NetApp Kubernetes Monitoring Operatorを停止および開始します

NetApp Kubernetes Monitoring Operatorを停止するには、次の手順を実行します

 kubectl -n netapp-monitoring scale deploy monitoring-operator --replicas=0
NetApp Kubernetes Monitoring Operatorを開始するには、次の手順を実行します

 kubectl -n netapp-monitoring scale deploy monitoring-operator --replicas=1


== アンインストール中です


NOTE: 以前にインストールしたスクリプトベースのKubernetesエージェントでを実行している場合は、を実行する必要があります <<をアップグレードして,アップグレード>> を使用して、NetApp Kubernetes Monitoring Operatorに接続します。



=== 廃止されたスクリプトベースのエージェントを削除します

これらのコマンドは、デフォルトの名前空間「 CI-monitoring 」を使用していることに注意してください。独自のネームスペースを設定した場合は、それらのネームスペースと、以降のすべてのコマンドおよびファイルを置き換えます。

Kubernetes上のスクリプトベースのエージェント（NetApp Kubernetes Monitoring Operatorへのアップグレードなど）をアンインストールするには、次の手順を実行します。

モニタリングネームスペースが Telegraf 専用に使用されている場合：

 kubectl --namespace ci-monitoring delete ds,rs,cm,sa,clusterrole,clusterrolebinding -l app=ci-telegraf
 kubectl delete ns ci-monitoring
モニタリングネームスペースが Telegraf 以外の目的で使用されている場合：

 kubectl --namespace ci-monitoring delete ds,rs,cm,sa,clusterrole,clusterrolebinding -l app=ci-telegraf


=== をクリックして、NetApp Kubernetes Monitoring Operatorを削除します

NetApp Kubernetes Monitoring Operatorのデフォルトのネームスペースは、「NetApp Monitoring」です。独自のネームスペースを設定した場合は、それらのネームスペースと、以降のすべてのコマンドおよびファイルを置き換えます。

新しいバージョンの監視オペレータは、次のコマンドを使用してアンインストールできます。

....
kubectl delete agent -A -l installed-by=nkmo-<name-space>
kubectl delete ns,clusterrole,clusterrolebinding,crd -l installed-by=nkmo-<name-space>
....
最初のコマンドが「リソースが見つかりません」を返した場合は、次の手順に従って古いバージョンの監視オペレータをアンインストールします。

次の各コマンドを順番に実行します。現在のインストール状況によっては、これらのコマンドの一部で「オブジェクトが見つかりません」というメッセージが返される場合があります。これらのメッセージは無視してかまいません。

....
kubectl -n <NAMESPACE> delete agent agent-monitoring-netapp
kubectl delete crd agents.monitoring.netapp.com
kubectl -n <NAMESPACE> delete role agent-leader-election-role
kubectl delete clusterrole agent-manager-role agent-proxy-role agent-metrics-reader <NAMESPACE>-agent-manager-role <NAMESPACE>-agent-proxy-role <NAMESPACE>-cluster-role-privileged
kubectl delete clusterrolebinding agent-manager-rolebinding agent-proxy-rolebinding agent-cluster-admin-rolebinding <NAMESPACE>-agent-manager-rolebinding <NAMESPACE>-agent-proxy-rolebinding <NAMESPACE>-cluster-role-binding-privileged
kubectl delete <NAMESPACE>-psp-nkmo
kubectl delete ns <NAMESPACE>
....
スクリプトベースの Tegraf インストール用に手動で作成した Security Context Constraint の場合は、次の手順を実行します。

 kubectl delete scc telegraf-hostaccess


== Kubeステートメトリックについて

NetApp Kubernetes Monitoring Operatorは、kube-state-metricsを自動的にインストールします。ユーザによる操作は必要ありません。



=== kube-state-metrics カウンタ

これらのkubbeステートメトリックカウンタの情報にアクセスするには、次のリンクを使用します。

. https://["ConfigMap メトリック"]
. https://["DemonSet メトリック"]
. https://["導入メトリック"]
. https://["入力メトリック"]
. https://["ネームスペース指標"]
. https://["ノードのメトリックス"]
. https://["永続的ボリューム指標"]
. https://["永続的ボリューム要求の指標"]
. https://["ポッドのメトリック"]
. https://["ReplicaSet メトリック"]
. https://["シークレットメトリック"]
. https://["サービスメトリック"]
. https://["Stat助け Set メトリック"]




== Kubernetes のチェックサムの検証

Cloud Insights エージェントのインストーラで整合性チェックが実行されますが、ダウンロードしたアーティファクトのインストールまたは適用前に独自の検証を実行したいユーザもいます。デフォルトのダウンロードおよびインストールではなく、ダウンロードのみの操作を実行するには、 UI から取得したエージェントインストールコマンドを編集し、末尾の「インストール」オプションを削除します。

次の手順を実行します。

. 指示に従ってエージェントインストーラスニペットをコピーします。
. スニペットをコマンドウィンドウに貼り付ける代わりに、テキストエディタに貼り付けます。
. コマンドから末尾の「--install」を削除します。
. コマンド全体をテキストエディタからコピーします。
. 次に、コマンドウィンドウ（作業ディレクトリ内）に貼り付けて実行します。
+
** Download and install （デフォルト）：
+
 installerName=cloudinsights-kubernetes.sh … && sudo -E -H ./$installerName --download –-install
** ダウンロードのみ：
+
 installerName=cloudinsights-kubernetes.sh … && sudo -E -H ./$installerName --download




download-only コマンドを使用すると、必要なアーティファクトがすべて Cloud Insights から作業ディレクトリにダウンロードされます。アーティファクトには次のものがありますが、これらに限定することはできません。

* インストールスクリプト
* 環境ファイル
* YAML ファイル
* 署名済みチェックサムファイル（ SHA256 署名）
* 署名の検証に使用する PEM ファイル（ NetApp_cert.pem ）


インストールスクリプト、環境ファイル、 YAML ファイルは、目視検査を使用して検証できます。

PEM ファイルは、フィンガープリントが次のようになっていることを確認することで検証できます。

 1A918038E8E127BB5C87A202DF173B97A05B4996
具体的には、

 openssl x509 -fingerprint -sha1 -noout -inform pem -in netapp_cert.pem
署名済みチェックサムファイルは、 PEM ファイルを使用して確認できます。

 openssl smime -verify -in sha256.signed -CAfile netapp_cert.pem -purpose any
すべてのアーティファクトが正常に検証されたら、次のコマンドを実行してエージェントのインストールを開始できます。

 sudo -E -H ./<installation_script_name> --install


== 951faa2232d4e162c12ecfe8efc935f7

64a4677d63e0753d438e5ff1996b08dd

 kubectl exec -c manager -it <operator-pod-name> -n <namespace> -- cat configs/substitution-vars/README.txt

NOTE: bc6b270b9094337edca8a85819407d18



== トラブルシューティング

NetApp Kubernetes Monitoring Operatorのセットアップで問題が発生した場合の対処方法を次に示します。

[cols="stretch"]
|===
| 問題 | 次の操作を実行します 


| Kubernetes 永続ボリュームと対応するバックエンドストレージデバイスの間にハイパーリンク / 接続がありません。My Kubernetes Persistent Volume がストレージサーバのホスト名を使用して設定されます。 | 手順に従って既存の Tegraf エージェントをアンインストールし、最新の Tegraf エージェントを再インストールします。Tegrafバージョン2.0以降を使用していて、KubernetesクラスタストレージがCloud Insights によってアクティブに監視されている必要があります。 


| 次のようなログにメッセージが表示されます。 E0901 15 ： 21 ： 39.96145 1 reflector.GO ： 178]k81.io/kube-state/internal/store/Builder.GO ： 352 ： Failed to list *v1.MutatingWebhookConfiguration ： 8s could not find the requested resource E0901 15:15:2ku161781. | これらのメッセージは、1.20より前のバージョンのKubernetesでkube-state-metricsバージョン2.0.0以上を実行している場合に発生する可能性があります。Kubernetes のバージョンを取得するには、次の Leubectl version_ kbe-state-metrics バージョンを取得します。 _kubectl デプロイ /kube-state-metrics -o jsonpath='{.image}'_ これらのメッセージが発生しないようにするには、 kube-state-metrics デプロイを修正して、次の Leases 設定を具体的に無効にしてください。 _hookates_web_volumeconfigurations resources= 証明リクエスト , configmaps,cronjobs,demonsets,horizontalscalers,ingleers,jobs,limitrange,scapers,networkpolicies , nodes,persistentvolumes,persistentvolumesalims,persistentvolumes,podeters, replicaSets,replicaSets,replicationcontrollers ,residetodポッド ,residetappeditors,appers,uns,uns,uns,uns,sets,uns,uns,uns,uns,uns,sets,uns,sets,uns,sets,uns,uns,sets,uns,uns,sets,uns,uns,uns,wodecodeclieticecodetics,sets,sets,sets,sets,uns,sets,uns,uns,sets,sets,sets,un 検証する Web フック設定 ' ボリュームの添付ファイル 


| Telegraf から次のようなエラーメッセージが表示されますが、 Telegraf は起動して実行されます。 Oct 11 14 ： 23 ： 41 IP-172-39-47 systemd[1] ： InfluxDB への指標の報告用に、プラグイン駆動型のサーバーエージェントを起動しました。10 月 11 日 14 ： 23 ： 41 IP-172-41-39-47 テレグラム [1827] ： time="2021 - 10-11T14 ： 23 ： 41Z" level= error msg=" キャッシュディレクトリの作成に失敗しました。/etc/テレ グラム /.cache/snowflake 、 err: mkdir /etc/テレ グラム f/.ca che: 許可が拒否されました。ignored \n" func = "gosnowfleke. (*defaultLogger).Errorf" file="log. go:120" Oct 11 14:23:41 IP-172-21-39-47 TEテレ グラフ [1827]: time="2021 - 10-11T14:23:41Z" level=error.msg=" 失敗しました。無視されます。/etc/テレ グラム /.cache/snowflake/ocspa_response_cache.json を開きます。ファイルまたはディレクトリがありません \n" func="gosnowflake.(*defaultLogger).Errorf" file="log.go:120"Oct. 1114:23:41 IP-172-41-39-47 テレグラム [1827:1127]~21-21Z: Telegraf 1.19.3 を起動しています | これは問題と呼ばれています。を参照してください link:https://github.com/influxdata/telegraf/issues/9407["この GitHub の記事"] 詳細：Tegraf が起動して動作している限り、ユーザはこのエラーメッセージを無視できます。 


| Kubernetes で、 Telegraf ポッドが次のエラーを報告しています。 "Error in processing mountstats info: failed to open mountstats file: /hostfs /proc/1/mountstats 、 error: open /hostfs /proc/1/mountstats ： permission denied" | SELinux が有効で強制されている場合、 Telegraf ポッドが Kubernetes ノードの /proc/1/mountstats ファイルにアクセスできない可能性があります。この制限を緩和するには、エージェントを編集します (`kubectl edit agent agent-monitoring-netapp`）を使用して、「privileged-mode：false」を「privileged-mode：true」に変更します。 


| Kubernetes で、 Telegraf ReplicaSet ポッドから次のエラーが報告されています。 [ プラグインの inputs.prometheus] エラー： Could not load keypair /etc/Kubernetes /pki/ etcd/server.crt ： /etc/Kubernetes /pki/ etcd/server.key ： open /etc/Kubernetes /pki/ etcd/server.key ：特定のディレクトリまたは crt ファイルをロードできませんでした | Telegraf ReplicaSet ポッドは、マスターまたは etcd 用に指定されたノード上で実行することを目的としています。これらのノードのいずれかで ReplicaSet ポッドが実行されていない場合は、これらのエラーが発生します。マスター / etcd ノードに汚染があるかどうかを確認します。その場合は、 Telegraf ReplicaSet 、テレグラム af-RS に必要な忍容を追加します。たとえば、 ReplicaSet...kubectl を編集して RS テレグラムを編集し、仕様に適切な公差を追加します。次に、 ReplicaSet ポッドを再起動します。 


| PSP/PSA環境があります。これはモニタリングオペレータに影響しますか？ | ポッドセキュリティポリシー（PSP）またはポッドセキュリティアドミッション（PSA）を適用してKubernetesクラスタを実行している場合は、最新のNetApp Kubernetes Monitoring Operatorにアップグレードする必要があります。PSP/PSAをサポートして現在のNKMOにアップグレードするには、次の手順に従います。1. <<uninstalling,をアンインストールします>> 前の監視オペレータ：kubectl delete agent agent-monitoring netapp -n netapp -monitoring kubectl delete ns NetApp-monitoring kubectl delete CRD agents.monitoring.netapp.com kubectl delete clusterrole agent-manager-role agent-proxy-metrics -reader kubectl delete clusterrolebinding agent-manager-rolebinding agent-proxy -proxy -proxy -proxy -proxy -proxy -proxy -proxy -binding中のクラスタ役割を持つadminエージェントの役割を持つ役割を持つ役割を果たす役割を担う役割は、それぞれ果たす役割を担う。 <<installing-the-netapp-kubernetes-monitoring-operator,をインストールします>> モニタリングオペレータの最新バージョン。 


| NKMOを導入する際に問題が発生し、PSP/PSAを使用しました。 | 1.次のコマンドを使用して、エージェントを編集します。kubectl -n <name-space> edit agent 2.「security-policy enabled」を「false」に設定します。これにより、ポッドセキュリティポリシーとポッドセキュリティアドミッションが無効になり、NKMOが展開できるようになります。次のコマンドを使用して確認します。kubectl get psp（should show Pod Security Policy removed）kubectl get all -n <namespace>| grep -i psp（should show that nothing is found） 


| 「ImagePullBackoff」エラーが発生しました | このエラーは、カスタムまたはプライベートのDockerリポジトリがあり、NetApp Kubernetes Monitoring Operatorで正しく認識されるように設定していない場合に表示されることがあります。 <<using-a-custom-or-private-docker-repository,詳細はこちら>> カスタム/プライベートリポジトリの設定について 


| 監視オペレータの配置に問題 を使用していますが、現在のドキュメントでは解決できません。  a| 
次のコマンドの出力をキャプチャまたはメモし、テクニカルサポートチームに連絡します。

[listing]
----
 kubectl -n netapp-monitoring get all
 kubectl -n netapp-monitoring describe all
 kubectl -n netapp-monitoring logs <monitoring-operator-pod> --all-containers=true
 kubectl -n netapp-monitoring logs <telegraf-pod> --all-containers=true
----


| NKMOネームスペース内のNet-Observer（ワークロードマップ）ポッドはCrashLoopBackOffにあります | これらのポッドは、Network ObservabilityのWorkload Mapデータコレクタに対応しています。以下を試してみてください:•いずれかのポッドのログをチェックして、カーネルの最小バージョンを確認してください。例：---｛"ci-tenant-id"："your-tenant-id"、"collector-cluster"："your-k8s-cluster-name"、"environment"："prod"、"level"："error"、"msg"："検証に失敗しました。理由:カーネルバージョン3.10.0が最小カーネルバージョン4.18.0よりも小さい、"time":"2022-11-09T08:23:08Z"}---•Net-observerポッドを使用するには、Linuxカーネルバージョンが4.18.0以上である必要があります。「uname -r」コマンドを使用してカーネルのバージョンを確認し、4.18.0以上であることを確認します 


| NKMO名前空間のnet-observerポッドは、OpenShift 4環境のCrashLoopBackOffにあります | これは現在サポートされていません。今後のアップデートでサポートが追加される予定です。 


| ポッドはNKMOネームスペース（デフォルト：netapp-monitoring）で実行されていますが、[Queries]のワークロードマップまたはKubernetes指標のデータがUIに表示されません | K8Sクラスタのノードの時間設定を確認します。監査およびデータレポートを正確に作成するには、Network Time Protocol（NTP；ネットワークタイムプロトコル）またはSimple Network Time Protocol（SNTP；簡易ネットワークタイムプロトコル）を使用してAgentマシンの時刻を同期することを強く推奨します。 


| NKMOネームスペース内の一部のnet-observerポッドが保留状態になっています | net-observerはデーモンセットであり、Kubernetesクラスタの各ノードでポッドを実行します。•保留状態のポッドをメモし、CPUまたはメモリのリソース問題 が発生しているかどうかを確認します。必要なメモリとCPUがノードにあることを確認します。 
|===
追加情報はから入手できます link:concept_requesting_support.html["サポート"] ページまたはを参照してください link:https://docs.netapp.com/us-en/cloudinsights/CloudInsightsDataCollectorSupportMatrix.pdf["Data Collector サポートマトリックス"]。
